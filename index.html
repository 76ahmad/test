<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>××¢×¨×›×ª × ×™×”×•×œ ××©××¨×•×ª</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“… ××¢×¨×›×ª × ×™×”×•×œ ××©××¨×•×ª</h1>
      <p>× ×™×”×•×œ ××©××¨×•×ª ×¢×•×‘×“×™× ×•××§×•××•×ª ×¢×‘×•×“×”</p>
    </div>

    <div class="controls">
      <button onclick="saveSchedule()">ğŸ’¾ ×©××•×¨ ×§×•×‘×¥</button>
      <input type="file" id="fileInput" accept=".json" onchange="loadSchedule(event)" style="display:none"/>
      <button onclick="document.getElementById('fileInput').click()">ğŸ“‚ ×˜×¢×Ÿ ×§×•×‘×¥</button>
      <button onclick="showAddPlaceModal()">â• ×”×•×¡×£ ××§×•×</button>
      <button onclick="showAddWorkerModal()">ğŸ‘¤ ×”×•×¡×£ ×¢×•×‘×“</button>
      <button onclick="showManagePlacesModal()">âš™ï¸ × ×™×”×•×œ ××§×•××•×ª</button>
      <button onclick="showManageWorkersModal()">ğŸ‘¥ × ×™×”×•×œ ×¢×•×‘×“×™×</button>
      <button class="btn-success" onclick="printSchedule()">ğŸ–¨ï¸ ×”×“×¤×¡×”</button>
      <button class="btn-info" onclick="exportToExcel()">ğŸ“Š ×™×¦× ×œ-Excel</button>
      <button class="btn-secondary" onclick="clearAssignments()">ğŸ—‘ï¸ × ×§×” ×”×§×¦××•×ª</button>
      <button class="btn-secondary" onclick="resetLocalStorage()">ğŸ”„ ××¤×¡ × ×ª×•× ×™×</button>
    </div>

    <div class="calendar-container">
      <div class="calendar-grid" id="calendar"></div>
    </div>

    <div id="assignmentSummary"></div>

    <div class="instructions">
      <h3>ğŸ“Œ ×”×•×¨××•×ª ×©×™××•×©</h3>
      <p>×œ×—×¥ ×¢×œ ×ª× ×›×“×™ ×œ×‘×—×•×¨ ××§×•× ×¢×‘×•×“×”. ×œ×—×¥ ×©×•×‘ ×›×“×™ ×œ×”×¡×™×¨ ×”×§×¦××”. ×”×©×ª××© ×‘×›×¤×ª×•×¨×™× ×›×“×™ ×œ×”×•×¡×™×£/×œ× ×”×œ ×¢×•×‘×“×™× ×•××§×•××•×ª.</p>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    let workers = [];
    let places = [];
    let assignments = {};
    const days = ["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"];

    function saveSchedule() {
      const data = { workers, places, assignments };
      const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "schedule.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadSchedule(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const data = JSON.parse(e.target.result);
        workers = data.workers || [];
        places = data.places || [];
        assignments = data.assignments || {};
        renderCalendar();
      };
      reader.readAsText(file);
    }

    function printSchedule() {
      window.print();
    }

    function exportToExcel() {
      const ws_data = [["×¢×•×‘×“", ...days]];
      workers.forEach(w => {
        const row = [w.name];
        days.forEach((d, di) => {
          let assigned = "";
          for (let key in assignments) {
            if (assignments[key] === di) {
              const [wid, day] = key.split("-");
              if (wid == workers.indexOf(w)) assigned = places[assignments[key]];
            }
          }
          row.push(assigned);
        });
        ws_data.push(row);
      });
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "×œ×•\"×–");
      XLSX.writeFile(wb, "schedule.xlsx");
    }

    function clearAssignments() {
      assignments = {};
      renderCalendar();
    }

    function resetLocalStorage() {
      workers = [];
      places = [];
      assignments = {};
      renderCalendar();
    }

    function renderCalendar() {
      const calendar = document.getElementById("calendar");
      calendar.innerHTML = "";
      const cols = days.length + 1;
      calendar.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

      // Header row
      const headerRow = document.createElement("div");
      headerRow.className = "header-cell";
      headerRow.textContent = "×¢×•×‘×“";
      calendar.appendChild(headerRow);
      days.forEach(d => {
        const cell = document.createElement("div");
        cell.className = "header-cell";
        cell.textContent = d;
        calendar.appendChild(cell);
      });

      // Workers rows
      workers.forEach((w, wi) => {
        const nameCell = document.createElement("div");
        nameCell.className = "name-cell";
        nameCell.textContent = w.name;
        calendar.appendChild(nameCell);

        days.forEach((d, di) => {
          const cell = document.createElement("div");
          cell.className = "time-cell";
          const key = `${wi}-${di}`;
          if (assignments[key] !== undefined) {
            cell.classList.add("assigned");
            cell.textContent = places[assignments[key]];
          }
          cell.onclick = () => {
            if (assignments[key] !== undefined) {
              delete assignments[key];
              cell.classList.remove("assigned");
              cell.textContent = "";
            } else {
              const choice = prompt("×‘×—×¨ ××§×•× ×¢×‘×•×“×”: " + places.join(", "));
              if (choice && places.includes(choice)) {
                assignments[key] = places.indexOf(choice);
                cell.classList.add("assigned");
                cell.textContent = choice;
              }
            }
          };
          calendar.appendChild(cell);
        });
      });
    }

    function showAddWorkerModal() {
      const name = prompt("×©× ×”×¢×•×‘×“ (×—×•×‘×”):");
      if (!name) return;
      const id = prompt("×ª×¢×•×“×ª ×–×”×•×ª (×œ× ×—×•×‘×”):") || "";
      const phone = prompt("×˜×œ×¤×•×Ÿ (×œ× ×—×•×‘×”):") || "";
      workers.push({ name, id, phone });
      renderCalendar();
    }

    function showAddPlaceModal() {
      const place = prompt("×©× ××§×•× ×”×¢×‘×•×“×”:");
      if (place) {
        places.push(place);
        renderCalendar();
      }
    }

    function showManageWorkersModal() {
      alert("× ×™×”×•×œ ×¢×•×‘×“×™× ×™×ª×•×¡×£ ×›××Ÿ (× ×™×ª×Ÿ ×œ×¢×¨×•×š/×œ××—×•×§ ×¢×•×‘×“×™×)");
    }

    function showManagePlacesModal() {
      alert("× ×™×”×•×œ ××§×•××•×ª ×™×ª×•×¡×£ ×›××Ÿ (× ×™×ª×Ÿ ×œ×¢×¨×•×š/×œ××—×•×§ ××§×•××•×ª)");
    }

    window.onload = renderCalendar;
  </script>
</body>
</html>
